(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[537],{86237:function(e,t,n){"use strict";n.d(t,{F:function(){return s},s:function(){return o}});var i=n(57218),a=n(16441),r=n(84917);function o(e){let t=(0,r.Y0)(e);if(t.length>31)throw Error("bytes32 string must be less than 32 bytes");return(0,a.Dv)((0,a.zo)([t,i.R]).slice(0,32))}function s(e){let t=(0,a.lE)(e);if(32!==t.length)throw Error("invalid bytes32 - not 32 bytes long");if(0!==t[31])throw Error("invalid bytes32 string - no null terminator");let n=31;for(;0===t[n-1];)n--;return(0,r.ZN)(t.slice(0,n))}},90385:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/proposals",function(){return n(74165)}])},9599:function(e,t,n){"use strict";n.d(t,{B:function(){return N}});var i=n(85893),a=n(23125),r=n(14710),o=n(87592),s=n(1449),l=n(86010),c=n(67294),u=n(85198),d=n(73772);let f={longitude:4.4775362,latitude:51.0258761},p={"line-width":1,"line-color":"rgba(0, 255, 0, 0.75)","line-dasharray":[3,3]},m={"fill-color":"rgba(0, 255, 0, 0.05)"};function N(e){let{onChange:t,positions:n=[],height:N=375,mode:h="read-only",theme:g="dark",rounded:y=!0,zoom:w=12}=e,[b,x]=(0,c.useState)(),[T,v]=(0,c.useState)();return(0,c.useEffect)(()=>{"editable"===h&&(v(new d.DrawPolygonMode),x(f))},[]),(0,c.useEffect)(()=>{if("read-only"===h&&(0,r.i)(n)){let e=(0,s.uf)(n||[]),t=(0,o.Z)(e);(0,r.i)(t)&&x({latitude:(t[1]+t[3])/2||f.latitude,longitude:(t[0]+t[2])/2||f.longitude,maxLongitude:t[2],minLongitude:t[0],maxLatitude:t[3],minLatitude:t[1]})}},[n,h]),(0,i.jsx)("div",{style:{height:N},className:"w-full",children:b?(0,i.jsxs)(u.default,{zoom:w,height:"100%",width:"100%",className:(0,l.Z)(y&&"rounded"),...b,mapboxApiAccessToken:"pk.eyJ1IjoidWJlcmRhdGEiLCJhIjoiY2pwY3owbGFxMDVwNTNxcXdwMms2OWtzbiJ9.1PPVl0VLUQgqrosrI2nUhg",mapStyle:"mapbox://styles/mapbox/".concat(g,"-v11"),onViewportChange:x,children:["editable"===h&&(0,i.jsx)(d.Editor,{clickRadius:13,mode:T,selectable:"editable"===h,features:n||[],onUpdate:e=>{let{data:n}=e;null==t||t(n)}}),"read-only"===h&&(null==n?void 0:n.map((e,t)=>(0,i.jsxs)(u.Source,{id:"source-".concat(t),type:"geojson",data:e,children:[(0,i.jsx)(u.Layer,{paint:p,id:"line-".concat(t),type:"line"}),(0,i.jsx)(u.Layer,{paint:m,id:"polygon-".concat(t),type:"fill"})]},t)))]}):(0,i.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,i.jsx)(a._,{className:"text-gray-500"})})})}},29237:function(e,t,n){"use strict";n.d(t,{d:function(){return c}});var i=n(87866),a=n(9196),r=n(67294),o=n(86501),s=n(98518),l=n(81074);function c(e){let{client:t}=(0,s.N)(),{getJsonFile:n}=(0,l.y)(),[c,u]=(0,r.useState)(),[d,f]=(0,r.useState)(!0);(0,r.useEffect)(()=>{e&&m().then(()=>f(!1))},[e]);let p=e=>{let t=new TextDecoder,n=t.decode(e),i=n.split("ipfs://")[1];return i.split("/")[0]};async function m(){if(e)try{let[r,o]=e.split("/"),s=new i.I3().setTokenId(r),l=await s.execute(t),c=new i.Rp(l.tokenId,Number(o)),d=await new i.Xq().setNftId(c).execute(t),f=await n(p(null==d?void 0:d[0].metadata),a.Y1.METADATA);u({...f,tokenId:c.toString()})}catch(e){console.error(e),o.ZP.error("Something went wrong. Please reload the page.")}}return(0,r.useMemo)(()=>({loading:d,forest:c}),[d,c])}},98518:function(e,t,n){"use strict";n.d(t,{N:function(){return o}});var i=n(87866);let a=i._q.fromString("3030020100300706052b8104000a042204209e09fd6bf996a6a4ca7ff0e67dffb16fbf8828a21b89dfa735866999fdc4b12f"),r=i.hX.fromString("0.0.14271926");function o(){return{accountId:r,privateKey:a,client:function(){let e=i.KU.forTestnet();return e.setOperator(r,a),e}()}}},81074:function(e,t,n){"use strict";n.d(t,{y:function(){return r}});var i=n(9196),a=n(96810);function r(){function e(){return new a.xk({token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJkaWQ6ZXRocjoweDAyYWUxYTE5NzMxRDI1OWU4ZDFkOTRDMzFhNTY2NTljMzE3QzFFZTAiLCJpc3MiOiJ3ZWIzLXN0b3JhZ2UiLCJpYXQiOjE2ODY2ODgyMjk5OTQsIm5hbWUiOiJoYXNoZ3JhcGgifQ.SFAL05NK16Vy75XmaclVHHy-tEPweI7AS4_AaX3ONLQ"})}async function t(t,n,a,r){let s=await e(),l=[o(JSON.stringify({name:t,creator:n,description:a,image:"https://bafybeibv3qve4co27gkgapqwftkmzcxgscbp4il7rwiyj2al4vl36hzfcu.ipfs.w3s.link/nft-placeholder.png",checksum:"ff32974d2a8cfeb8deb2437556b53296021bfe02d466f449d52b583a6e8fbcef",type:"image/png",format:"HIP412@2.0.0",properties:{location:r}}),"".concat(i.Y1.METADATA,".json"))];return s.put(l)}async function n(t){let n=await e(),{images:a,forest:r,...s}=t,l=[o(JSON.stringify(s),"".concat(i.Y1.PROPOSAL,".json")),o(JSON.stringify({title:s.title}),"".concat(i.Y1.METADATA,".json"))];return a&&l.push(...a.map(e=>new File([e],"images/".concat(e.name)))),n.put(l)}async function r(t){let n=await e();return n.put([o(JSON.stringify(t),"".concat(i.Y1.OBJECTION,".json"))])}function o(e,t){return new File([new Blob([e])],t,{type:"application/json",lastModified:new Date().getTime()})}async function s(t,n){let i=await e(),a=await (null==i?void 0:i.get(t)),r=await (null==a?void 0:a.files()),o="".concat(n,".json"),s=null==r?void 0:r.find(e=>e.name===o);if(!s)return;let c=new TextDecoder,u="";return await l(s,e=>u+=c.decode(e)),{...JSON.parse(u),cid:t}}async function l(e,t){let n=e.stream().getReader();for(;;){let{done:e,value:i}=await n.read();if(e)break;t(i)}}let c=(e,t)=>"https://dweb.link/ipfs/".concat(e,"/").concat(t);return{getJsonFile:s,uploadForest:t,getImageUrls:async function(t){let n=await e(),i=await n.get(t),a=await (null==i?void 0:i.files()),r=null==a?void 0:a.filter(e=>e.name.startsWith("images/"));return(null==r?void 0:r.map(e=>c(t,e.name)))||[]},uploadProposal:n,uploadObjection:r}}},74165:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return I}});var i=n(85893),a=n(65037),r=n(75125),o=n(22784),s=n(98963),l=n(14710),c=n(44292),u=n(41664),d=n.n(u),f=n(9599),p=n(86237),m=n(29237);function N(e){var t,n;let{proposal:a}=e,{forest:r}=(0,m.d)(null==a?void 0:a.forestTokenId),o=(null==a?void 0:null===(t=a.description)||void 0===t?void 0:t.length)>100?"".concat(null==a?void 0:null===(n=a.description)||void 0===n?void 0:n.substring(0,100),"..."):null==a?void 0:a.description;return(0,i.jsxs)(d(),{href:(0,c.PV)(p.F(a.id)),className:"bg-transition flex-wrap rounded bg-gray-100 hover:bg-gray-200",children:[(0,i.jsx)("div",{className:"overflow-hidden rounded-t",children:(0,i.jsx)(f.B,{theme:"dark",positions:null==r?void 0:r.properties.location,height:150,rounded:!1})}),(0,i.jsx)("div",{className:"px-4 py-10",children:(0,i.jsxs)("div",{className:"mb-2 break-all border-b border-gray-200 pb-2 last:mb-0 last:border-0 last:pb-0",children:[(0,i.jsx)("div",{className:"font-medium capitalize",children:(null==a?void 0:a.title)||"-"}),(0,i.jsx)("div",{className:"text-xs text-gray-500",children:o})]})})]})}var h=n(9196),g=n(53405),y=n(68209),w=n(67294),b=n(86501),x=n(81074),T=n(32802),v=n(48005);function O(){let{proposals:e,loading:t}=function(){let{signer:e}=(0,T.aF)(),[t,n]=(0,w.useState)([]),[i,a]=(0,w.useState)(!0),{getJsonFile:r}=(0,x.y)();async function o(){try{let t=new y.CH(v.w.address,v.w.abi,e),i=[],o=await t.getProposalsByPage(0);for(let e of o){let t=(0,g.a)(e),n=await r(e.cid,h.Y1.PROPOSAL),a=(0,g.F)(n);i.push({...t,...a})}n(i),a(!1)}catch(e){console.error(e),b.ZP.error("Something went wrong. Please reload the page.")}}return(0,w.useEffect)(()=>{o()},[]),(0,w.useMemo)(()=>({loading:i,proposals:t}),[i,t])}();return(0,i.jsx)("section",{className:"mx-auto w-3/4",children:(0,i.jsxs)("div",{className:"flex flex-col space-y-16 ",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(s.H1,{className:"!text-3xl font-black",children:"Proposals"}),(0,i.jsx)(o.n,{className:"w-7/12 text-sm text-gray-700",children:"Forests get reshaped countless times. Yet in most cases, the destruction or adaptation of local fauna and floras happens without the consent of local communities."})]}),(0,i.jsx)(d(),{href:c.W5,children:(0,i.jsx)(r.z,{variant:"primary",className:"px-3 py-1",children:"New Proposal"})})]}),(0,i.jsx)("div",{className:"space-y-10",children:t?(0,i.jsx)("div",{className:"grid grid-cols-3 gap-4",children:Array(6).fill(null).map((e,t)=>(0,i.jsx)("div",{className:"h-[300px] w-full animate-pulse rounded bg-gray-200"},t))}):(0,l.i)(e)?(0,i.jsx)("div",{className:"grid grid-cols-3 gap-4",children:e.map((e,t)=>(0,i.jsx)(N,{proposal:e},t))}):(0,i.jsx)("div",{className:"flex rounded bg-gray-100 px-6 py-3",children:(0,i.jsx)("div",{className:"text-gray-500",children:"No proposals found.."})})})]})})}function I(){return(0,i.jsx)(a.W,{withTopPadding:!0,children:(0,i.jsx)(O,{})})}},9196:function(e,t,n){"use strict";var i,a,r,o,s,l,c;n.d(t,{WD:function(){return a},Y1:function(){return r},dz:function(){return i}}),(s=i||(i={}))[s.FOR=0]="FOR",s[s.AGAINST=1]="AGAINST",s[s.ABSTAIN=2]="ABSTAIN",(l=a||(a={})).MOBILITY="mobility",l.SPATIAL_PLANNING="spatial-planning",l.CONFLICT_OF_INTEREST="conflict-of-interest",l.DE_PAVING="de-paving",l.PROCEDURE="procedure",l.CONSTRUCTION_PHASE="construction-phase",l.IMPACT_ON_CLIMATE="impact-on-climate",l.SAFETY="safety",l.VISUAL_IMPACT="visual-impact",l.PRIVACY="privacy",l.NUISANCE="nuisance",l.MATERIAL_USAGE="material-usage",l.FOREST_COMPENSATION="forest-compensation",l.HEALTH="health",l.ENERGY_CONSUMPTION="energy-consumption",l.PLANNING_CONTEXT="planning-context",l.ENVIRONMENTAL_IMPACT_REPORT="environmental-impact-report",l.WATER="water",l.AIR_QUALITY="air-quality",l.ECOLOGY="ecology",l.NOISE_POLLUTION="noise-pollution",l.LIGHT_POLLUTION="light-pollution",l.ODOR_NUISANCE="odor-nuisance",(c=r||(r={})).OBJECTION="objection",c.METADATA="metadata",c.PROPOSAL="proposal",(o||(o={})).PROPOSAL="proposal"},53405:function(e,t,n){"use strict";function i(e){if(e)return{id:e.id,cid:e.cid,author:e.author,forestTokenId:e.forestTokenId,abstainVotes:Number(e.abstainVotes),againstVotes:Number(e.againstVotes),forVotes:Number(e.forVotes),startTimestamp:new Date(1e3*Number(e.startTimestamp)),endTimestamp:new Date(1e3*Number(e.endTimestamp))}}function a(e){if(e)return{title:null==e?void 0:e.title,description:null==e?void 0:e.description}}n.d(t,{F:function(){return a},a:function(){return i}})},71231:function(){},89214:function(){},85568:function(){}},function(e){e.O(0,[169,714,634,715,765,866,635,810,204,209,37,5,774,888,179],function(){return e(e.s=90385)}),_N_E=e.O()}]);